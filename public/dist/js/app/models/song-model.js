define(["backbone","backbone.localstorage"],function(e){var n=e.Model.extend({urlRoot:"/songs",validate:function(e){var n={},r="该项填写有误",t=["resources","error","song_src","pic_src","first_sentence"];return _.each(e,function(e,s){-1==_.indexOf(t,s)&&("index"==s?(!e||isNaN(e))&&(n[s]=r):e||(n[s]=r))}),_.isEmpty(n)?void 0:n}}),r=e.Collection.extend({model:n,url:"/songs",localStorage:new e.LocalStorage("Songs"),deferred:null,frontRestful:function(e){this.deferred=new $.Deferred;var n=e.split("/"),r=n[1],t=n[2];return this[r](decodeURIComponent(t),e),this.deferred},songs:function(){var e=this;this.deferred.resolve(e)},songs_category:function(e){var n=this.where({category_big:e}),r=new t.Songs(n);this.deferred.resolve(r)},songs_search:function(e){var n=[];if(isNaN(e)){var r=this.filter(function(n){return n.get("name").indexOf(e)>-1}),s=this.filter(function(n){return n.get("first_sentence").indexOf(e)>-1});n=r.concat(s)}else n=this.where({index:parseInt(e,10)});var o=new t.Songs(n);this.deferred.resolve(o)},songs_filter:function(e,n){var r=new t.Songs;r.url=n,r.fetch({success:$.proxy(function(e,n){n&&!n.error&&this.deferred.resolve(r)},this),ajaxSync:!0})}}),t={Song:n,Songs:r};return t});