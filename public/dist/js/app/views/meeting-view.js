define(["jquery","backbone","text!app/templates/meeting-template.html","app/models/meeting-model","app/models/song-model","app/views/song-view","helper","utils/utils","bootstrap"],function(e,t,n,i,r,s,l,o){var a=t.View.extend({template:"#MeetingsTemplate",initialize:function(){this.render(),this.renderMeetings(),this.$el.tooltip({selector:'*[data-toggle="tooltip"]'})},render:function(){var t=_.template(e(n).find(this.template).html());this.$el.html(t()),e("#IndexContainer").empty().html(this.el)},renderMeetings:function(){_.each(this.collection.models,function(e){{var t=this.renderContainer(e);new d.MeetingView({model:e,$target:t})}},this)},renderContainer:function(){var t=e("<div />").addClass("song-list-container row"),n=e("<div />").addClass("col-md-12");return t.append(n),this.$el.find(".panel-group").append(t),n}}),d=t.View.extend({options:null,className:"panel panel-default song-list-panel",template:"#MeetingTemplate",initialize:function(e){this.options=e||{},this.render(),this.renderAlert(),this.renderMeetingSongs()},render:function(){this.$el.attr("status",this.model.get("status"));var t=_.template(e(n).find(this.template).html());this.$el.html(t(_.extend({},this,{helper:l}))),this.options.$target.empty().html(this.el)},renderMeetingSongs:function(){{var e=new i.MeetingSongs(this.model.get("meeting_songs")),t=this.$el.find('*[meeting_id="'+this.model.id+'"]');new d.MeetingSongsView({collection:e,el:t})}},renderAlert:function(){var t=e("<span />").addClass("pull-right song-list-alert").attr("tag","alert");this.options.$target.prepend(t)},events:{'click *[tag="save"]':"save",'click *[tag="edit"]':"edit",'dblclick *[tag="del"]':"del"},save:function(t){var n=this,i=o.getObjFromForm(this.$el.find("form"));i.status="confirmed",this.model.save(i,{wait:!0,$btn:e(t.currentTarget),success:function(e,t){if(t&&!t.error){n.options.$target.closest(".panel-group").find('*[tag="alert"]').empty();{new d.MeetingView({model:e,$target:n.options.$target})}n.remove()}}})},edit:function(t){var n=this.$el.closest(".panel-group").find('*[status="current"]');if(n.length>1){var i=e(o.getAlertHtml("alert-danger","请先保存“未保存的歌单”")),n=this.options.$target.find('*[tag="alert"]').first();o.renderAlert(n,i)}else{var r=this;this.model.save({status:"current"},{wait:!0,$btn:e(t.currentTarget),success:function(e,t){if(t&&!t.error){{new d.MeetingView({model:e,$target:r.options.$target})}r.remove()}}})}},del:function(t){var n=this;this.model.destroy({wait:!0,$btn:e(t.currentTarget),success:function(e,t){t&&!t.error&&n.remove()}})}}),g=t.View.extend({initialize:function(){this.render()},render:function(){var e=this.$el.find("tbody");e.empty(),this.$el.hide(),_.each(this.collection.models,function(t){var n=new r.Song(t.get("song")),i=new s.SongView({model:n,$target:e});if("current"==e.attr("status")){new d.MeetingSongView({model:t,el:i.$el})}},this),this.$el.show()}}),c=t.View.extend({template:"#MeetingSongTemplate",initialize:function(){this.render()},render:function(){var t=_.template(e(n).find(this.template).html());this.$el.find("td").last().append(t())},events:{'click *[tag="del"]':"del"},del:function(t){var n=this;this.model.destroy({wait:!0,$btn:e(t.currentTarget),success:function(e,t){t&&!t.error&&n.remove()}})}}),d={MeetingView:d,MeetingsView:a,MeetingSongView:c,MeetingSongsView:g};return d});