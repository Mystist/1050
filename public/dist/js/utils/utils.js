// Copyright NProgress. For custom use. Simulate uploading progress cause IE 8 has no `loaded` object.

define(["jquery","nprogress/nprogress","backbone"],function(t,e){e.configure({showSpinner:!1});var n={setGlobalAjaxSettings:function(){var e=this;t.ajaxSetup({global:!0,cache:!0}),t(document).ajaxSend(function(t,n,r){e.before(t,n,r)}),t(document).ajaxComplete(function(t,n,r){e.complete(t,n,r)}),t(document).ajaxSuccess(function(t,n,r){n.responseJSON&&!n.responseJSON.error?e.success(t,n,r):e.error(t,n,r)}),t(document).ajaxError(function(t,n,r){e.error(t,n,r)})},before:function(t,n,r){0!=r.isShowNProgress&&(e.set(.6),e.start()),r.$btn&&r.$btn.attr("disabled","disabled")},complete:function(t,n,r){0!=r.isShowNProgress&&e.done(),r.$btn&&r.$btn.removeAttr("disabled")},success:function(e,n,r){if(r.$btn){var s=t(this.getAlertHtml("alert-success","操作成功")),i=r.$btn.closest(".row").find('*[tag="alert"]').first();this.renderAlert(i,s)}},error:function(e,n,r){if(r.$btn){var s="操作失败，请刷新页面重试";n.responseJSON&&n.responseJSON.error&&"string"==typeof n.responseJSON.error&&(s=n.responseJSON.error);var i=t(this.getAlertHtml("alert-danger",s)),o=r.$btn.closest(".row").find('*[tag="alert"]').first();this.renderAlert(o,i)}},getObjFromForm:function(t){var e={};return t.find("select, input").each(function(){e[this.name]=this.value}),e},getAlertHtml:function(t,e){var n="";return n+='<label class="alert '+t+'"><strong>'+e+"</strong></label>"},renderAlert:function(t,e,n){var n=n||4500;t&&(t.html(e),setTimeout(function(){e.remove()},n))},renderNowPlaying:function(t,e){var n=t.closest('*[tag="songsContainer"]').first();n.find('tr[class="'+e+'"]').removeClass(e),t.closest("tr").addClass(e)},Progress:function(){var t=function(){this.settings={minimum:.08,trickleRate:.02,trickleSpeed:800,trickle:!0,$target:null,render:null}};return t.prototype={constructor:t,init:function(t,e){this.settings.$target=t,this.settings.render=e},status:null,set:function(t){t=this.clamp(t,this.settings.minimum,1),this.status=1===t?null:t,this.settings.render(this.settings.$target,parseFloat((100*t).toFixed(2),10))},start:function(){var t=this;this.status||this.set(0);var e=function(){setTimeout(function(){t.status&&(t.trickle(),e())},t.settings.trickleSpeed)};this.settings.trickle&&e()},inc:function(t){var e=this.status;e?("number"!=typeof t&&(t=(1-e)*this.clamp(Math.random()*e,.1,.95)),e=this.clamp(e+t,0,.994),this.set(e)):this.start(t)},trickle:function(){this.inc(Math.random()*this.settings.trickleRate)},done:function(){this.inc(.3+.5*Math.random()),this.set(1)},clamp:function(t,e,n){return e>t?e:t>n?n:t}},new t}};return n});