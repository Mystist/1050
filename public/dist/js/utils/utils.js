// Copyright NProgress. For custom use. Simulate uploading progress cause IE 8 has no `loaded` object.

define(["jquery","nprogress/nprogress","backbone"],function(t,e){e.configure({showSpinner:!1});var r={setGlobalAjaxSettings:function(){var e=this;t.ajaxSetup({global:!0,cache:!0}),t(document).ajaxSend(function(t,r,n){e.before(t,r,n)}),t(document).ajaxComplete(function(t,r,n){e.complete(t,r,n)}),t(document).ajaxSuccess(function(t,r,n){r.responseJSON&&!r.responseJSON.error?e.success(t,r,n):e.error(t,r,n)}),t(document).ajaxError(function(t,r,n){e.error(t,r,n)})},before:function(t,r,n){0!=n.isShowNProgress&&(e.set(.6),e.start()),n.$btn&&n.$btn.attr("disabled","disabled")},complete:function(t,r,n){0!=n.isShowNProgress&&e.done(),n.$btn&&n.$btn.removeAttr("disabled")},success:function(e,r,n){if(n.$btn){var s=t(this.getAlertHtml("alert-success","操作成功")),i=n.$btn.closest(".row").find('*[tag="alert"]').first();this.renderAlert(i,s)}},error:function(e,r,n){if(n.$btn){var s="操作失败，请刷新页面重试";r.responseJSON&&r.responseJSON.error&&"string"==typeof r.responseJSON.error&&(s=r.responseJSON.error);var i=t(this.getAlertHtml("alert-danger",s)),o=n.$btn.closest(".row").find('*[tag="alert"]').first();this.renderAlert(o,i)}},getObjFromForm:function(t){var e={};return t.find("select, input").each(function(){e[this.name]=this.value}),e},getAlertHtml:function(t,e){var r="";return r+='<label class="alert '+t+'"><strong>'+e+"</strong></label>"},renderAlert:function(t,e,r){var r=r||4500;t&&(t.html(e),setTimeout(function(){e.remove()},r))},renderNowPlaying:function(t,e){var r=t.closest(".table");r.find('tr[class="'+e+'"]').removeClass(e),t.closest("tr").addClass(e)},Progress:function(){var t=function(){this.settings={minimum:.08,trickleRate:.02,trickleSpeed:800,trickle:!0,$target:null,render:null}};return t.prototype={constructor:t,init:function(t,e){this.settings.$target=t,this.settings.render=e},status:null,set:function(t){t=this.clamp(t,this.settings.minimum,1),this.status=1===t?null:t,this.settings.render(this.settings.$target,parseFloat((100*t).toFixed(2),10))},start:function(){var t=this;this.status||this.set(0);var e=function(){setTimeout(function(){t.status&&(t.trickle(),e())},t.settings.trickleSpeed)};this.settings.trickle&&e()},inc:function(t){var e=this.status;e?("number"!=typeof t&&(t=(1-e)*this.clamp(Math.random()*e,.1,.95)),e=this.clamp(e+t,0,.994),this.set(e)):this.start(t)},trickle:function(){this.inc(Math.random()*this.settings.trickleRate)},done:function(){this.inc(.3+.5*Math.random()),this.set(1)},clamp:function(t,e,r){return e>t?e:t>r?r:t}},new t}};return r});