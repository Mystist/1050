// Copyright NProgress. For custom use. Simulate uploading progress cause IE 8 has no `loaded` object.

define(["jquery","nprogress/nprogress","backbone"],function(e,t,n){t.configure({showSpinner:!1});var r={setGlobalAjaxSettings:function(){var t=this;e.ajaxSetup({global:!0,cache:!0}),e(document).ajaxSend(function(e,n,r){t.before(e,n,r)}),e(document).ajaxComplete(function(e,n,r){t.complete(e,n,r)}),e(document).ajaxSuccess(function(e,n,r){n.responseJSON&&!n.responseJSON.error?t.success(e,n,r):t.error(e,n,r)}),e(document).ajaxError(function(e,n,r){t.error(e,n,r)})},before:function(e,n,r){r.isShowNProgress!=0&&(t.set(.6),t.start()),r.$btn&&r.$btn.attr("disabled","disabled")},complete:function(e,n,r){r.isShowNProgress!=0&&t.done(),r.$btn&&r.$btn.removeAttr("disabled")},success:function(t,n,r){if(r.$btn){var i=e(this.getAlertHtml("alert-success","操作成功")),s=r.$btn.closest(".row").find('*[tag="alert"]').first();this.renderAlert(s,i)}},error:function(t,n,r){if(r.$btn){var i="操作失败，请刷新页面重试";n.responseJSON&&n.responseJSON.error&&typeof n.responseJSON.error=="string"&&(i=n.responseJSON.error);var s=e(this.getAlertHtml("alert-danger",i)),o=r.$btn.closest(".row").find('*[tag="alert"]').first();this.renderAlert(o,s)}},getObjFromForm:function(e){var t={};return e.find("select, input").each(function(){t[this.name]=this.value}),t},getAlertHtml:function(e,t){var n="";return n+='<label class="alert '+e+'">'+"<strong>"+t+"</strong>"+"</label>",n},renderAlert:function(e,t,n){var n=n||4500;e&&(e.html(t),setTimeout(function(){t.remove()},n))},Progress:function(){var e=function(){this.settings={minimum:.08,trickleRate:.02,trickleSpeed:800,trickle:!0,$target:null,render:null}};return e.prototype={constructor:e,init:function(e,t){this.settings.$target=e,this.settings.render=t},status:null,set:function(e){e=this.clamp(e,this.settings.minimum,1),this.status=e===1?null:e,this.settings.render(this.settings.$target,parseFloat((e*100).toFixed(2),10))},start:function(){var e=this;this.status||this.set(0);var t=function(){setTimeout(function(){if(!e.status)return;e.trickle(),t()},e.settings.trickleSpeed)};this.settings.trickle&&t()},inc:function(e){var t=this.status;t?(typeof e!="number"&&(e=(1-t)*this.clamp(Math.random()*t,.1,.95)),t=this.clamp(t+e,0,.994),this.set(t)):this.start(e)},trickle:function(){this.inc(Math.random()*this.settings.trickleRate)},done:function(){this.inc(.3+.5*Math.random()),this.set(1)},clamp:function(e,t,n){return e<t?t:e>n?n:e}},new e}};return r});